# John the Ripper

## Cracking salted hashes

To use what is known as dynamic scripting, first we list the formats supported

```text
ivan@Laptop:/*****************/HTB/Bart$ /opt/john/run/john --list=subformats | grep sha2
Format = dynamic_50  type = dynamic_50: sha224($p)
Format = dynamic_51  type = dynamic_51: sha224($s.$p)
Format = dynamic_52  type = dynamic_52: sha224($p.$s)
Format = dynamic_53  type = dynamic_53: sha224(sha224($p))
Format = dynamic_54  type = dynamic_54: sha224(sha224_raw($p))
Format = dynamic_55  type = dynamic_55: sha224(sha224($p).$s)
Format = dynamic_56  type = dynamic_56: sha224($s.sha224($p))
Format = dynamic_57  type = dynamic_57: sha224(sha224($s).sha224($p))
Format = dynamic_58  type = dynamic_58: sha224(sha224($p).sha224($p))
Format = dynamic_60  type = dynamic_60: sha256($p)
Format = dynamic_61  type = dynamic_61: sha256($s.$p)
Format = dynamic_62  type = dynamic_62: sha256($p.$s)
Format = dynamic_63  type = dynamic_63: sha256(sha256($p))
Format = dynamic_64  type = dynamic_64: sha256(sha256_raw($p))
Format = dynamic_65  type = dynamic_65: sha256(sha256($p).$s)
Format = dynamic_66  type = dynamic_66: sha256($s.sha256($p))
Format = dynamic_67  type = dynamic_67: sha256(sha256($s).sha256($p))
Format = dynamic_68  type = dynamic_68: sha256(sha256($p).sha256($p))
UserFormat = dynamic_1029  type = dynamic_1029: sha256($p) (hash truncated to length 32)
UserFormat = dynamic_1503  type = dynamic_1503: sha256(sha256($p).$s) (XenForo SHA-256)
UserFormat = dynamic_1528  type = dynamic_1528: sha256($s.$p.$s) (Telegram for Android)
UserFormat = dynamic_1588  type = dynamic_1588: sha256($s.sha1($p)) (ColdFusion 11)
UserFormat = dynamic_1602  type = dynamic_1602: sha256(#.$salt.-.$pass) (QAS vas_auth)
UserFormat = dynamic_1608  type = dynamic_1608: sha256(sha256_raw(sha256_raw($p))) (Neo Wallet)
```

Let's suppose in our **config.php** we see these lines on the salt used and format.

```php
$salt = '8h@tr-waswe_aT#9TaCHuPhU'; //for security reasons please replace this string with your own random string (before attempt to register any user)
return hash('sha256', $passwd.$salt); //return sha256 hash of the salted password
```

Then we know to pick **dynamic_62**. This requires the format of the hashes to be **username:hash$salt**

```text
ivan@Laptop:/*****************/HTB/Bart$ cat db_hash
harvey:faeff13072fffdb78ec3b08427678f18295ee28b8b0befc63eea2135eee85df3$8h@tr-waswe_aT#9TaCHuPhU
bobby:e15929d8ce341f2dfa07ac7a0b6f32379e43868631f2aebc05a3a97b235d6dcc$8h@tr-waswe_aT#9TaCHuPhU
daniel:f7dbfae1e05efda233b872e9b7f709d3a0f1b042813be01d7e5b9e9788c7c801$8h@tr-waswe_aT#9TaCHuPhU
```

We can then crack it with

```text
ivan@Laptop:/*****************/HTB/Bart$ /opt/john/run/john --wordlist=/opt/Seclists/rockyou.txt --format=dynamic_62 --rules db_hash
Using default input encoding: UTF-8
Loaded 3 password hashes with no different salts (dynamic_62 [sha256($p.$s) 256/256 AVX2 8x])
Warning: no OpenMP support for this hash type, consider --fork=8
Press 'q' or Ctrl-C to abort, almost any other key for status
Password1        (harvey)
1g 0:00:00:53 DONE (2021-04-27 20:15) 0.01885g/s 4405Kp/s 4405Kc/s 8810KC/s Acerelamoring..Aaaaaaaaaaaaing
Use the "--show --format=dynamic_62" options to display all of the cracked passwords reliably
Session completed.
```

#### References

1. https://security.stackexchange.com/questions/92614/how-to-crack-salt-sha256salt-password-hashes-with-jtr
2. https://security.stackexchange.com/questions/22648/cracking-md5-with-salt-using-jtr

## Cracking unsalted hashes

This is much easier. Note only 1/3 is cracked in this case. And we didn't have to specify the hash type.

```text
ivan@Laptop:/*****************/HTB/Bart$ cat monitor_hash
daniel:$2y$10$uagzza/86ZyHN9D7rCz6duKcYFO2JwKY6vNIrjHzuXUiyhl4gZThS
harvey:$2y$10$rX2CrXDnE06wOXL7H2Vm2OFSGOEqh5LifQ1Z/qZMmA9aEemoq3p0C
bobby:$2y$10$dwC0mmzzxBk93jRIhr0Jb.7ksIBnME.Y5R7xOe51yi1fvifHmP3T.

ivan@Laptop:/*****************/HTB/Bart$ /opt/john/run/john --wordlist=/opt/Seclists/rockyou.txt --rules monitor_hash
Using default input encoding: UTF-8
Loaded 3 password hashes with 3 different salts (bcrypt [Blowfish 32/64 X3])
Cost 1 (iteration count) is 1024 for all loaded hashes
Will run 8 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
potter           (harvey)
1g 0:00:20:40 0.01% (ETA: 2021-09-02 09:02) 0.000805g/s 74.10p/s 148.7c/s 148.7C/s nykole..narakjung
1g 0:00:53:35 0.03% (ETA: 2021-08-30 22:36) 0.000311g/s 75.61p/s 151.4c/s 151.4C/s idontlove..hunter86
1g 0:00:53:37 0.03% (ETA: 2021-08-30 22:42) 0.000310g/s 75.60p/s 151.4c/s 151.4C/s hotshot5..honeyl
Use the "--show" option to display all of the cracked passwords reliably
Session aborted
```

If we did, it'll be this. We can list the supported formats with `john --list=formats`

```text
ivan@Laptop:/*************/HTB/Node$ /opt/john/run/john --wordlist=/opt/Seclists/rockyou.txt --format=Raw-SHA256 --rules hashes
Using default input encoding: UTF-8
Loaded 3 password hashes with no different salts (Raw-SHA256 [SHA256 256/256 AVX2 8x])
Warning: poor OpenMP scalability for this hash type, consider --fork=8
Will run 8 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
spongebob        (tom)
snowflake        (mark)
2g 0:00:00:49 DONE (2021-04-02 13:48) 0.04023g/s 4701Kp/s 4701Kc/s 4706KC/s Infamouzchiking..Aaaaaaaaaaaaing
Use the "--show --format=Raw-SHA256" options to display all of the cracked passwords reliably
Session completed.
```

