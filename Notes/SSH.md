# SSH

If you have the SSH private key of a user, but the login shell is set to **/bin/false** or otherwise inaccessible, there's no way to bypass it other than exploiting the script assigned. See explanations [here](https://security.stackexchange.com/questions/191939/bypassing-the-command-script-specified-in-etc-passwd/191941#191941) and [here](https://unix.stackexchange.com/questions/266075/how-to-login-by-ssh-when-default-shell-is-wrong/266083#266083). Eg.

```plaintext
 dali:x:1000:1000:dali,,,:/home/dali:/usr/bin/psysh
```

SSH login will enter psysh shell

```shell
root@Kali:~/HTB/LaCasaDePapel/ssh_keys# ssh -i id_rsa dali@10.10.10.131

 _             ____                  ____         ____                  _ 
| |    __ _   / ___|__ _ ___  __ _  |  _ \  ___  |  _ \ __ _ _ __   ___| |
| |   / _` | | |   / _` / __|/ _` | | | | |/ _ \ | |_) / _` | '_ \ / _ \ |
| |__| (_| | | |__| (_| \__ \ (_| | | |_| |  __/ |  __/ (_| | |_) |  __/ |
|_____\__,_|  \____\__,_|___/\__,_| |____/ \___| |_|   \__,_| .__/ \___|_|
                                                            |_|       

Psy Shell v0.9.9 (PHP 7.2.10 â€” cli) by Justin Hileman
>>>
```

Cannot bypass with `-t`

```shell
root@Kali:~/HTB/LaCasaDePapel/ssh_keys# ssh -t -i id_rsa dali@10.10.10.131 bash
PHP Warning:  require(bash): failed to open stream: No such file or directory in phar:///usr/bin/psysh/src/Configuration.php on line 263
PHP Fatal error:  require(): Failed opening required 'bash' (include_path='.:/usr/share/php7') in phar:///usr/bin/psysh/src/Configuration.php on line 263
Connection to 10.10.10.131 closed.
root@Kali:~/HTB/LaCasaDePapel/ssh_keys# ssh -i id_rsa dali@10.10.10.131 -t '/bin/bash'
<throws up a lot of garbage>
```

### SSH port forwarding

Its possible to do dynamic port forward and discover ports listening on localhost though.

```shell
root@Kali:~/HTB/LaCasaDePapel/ssh_keys# ssh -D 22222 -f -N -i id_rsa dali@10.10.10.131

root@Kali:~/HTB/LaCasaDePapel# tail /etc/proxychains.conf 
#
#       proxy types: http, socks4, socks5
#        ( auth types supported: "basic"-http  "user/pass"-socks )
#
[ProxyList]
# add proxy here ...
# meanwile
# defaults set to "tor"
socks5 	127.0.0.1 22222
#http	127.0.0.1 8080
root@Kali:~/HTB/LaCasaDePapel# netstat -ant | grep 22222
tcp        0      0 127.0.0.1:22222         0.0.0.0:*               LISTEN     
tcp6       0      0 ::1:22222               :::*                    LISTEN     
root@Kali:~/HTB/LaCasaDePapel# proxychains nmap -Pn -n -sT -p- 127.0.0.1
ProxyChains-3.1 (http://proxychains.sf.net)
Starting Nmap 7.80 ( https://nmap.org ) at 2020-11-07 22:47 +08
Nmap scan report for 127.0.0.1
Host is up (0.0058s latency).
Not shown: 65529 closed ports
PORT      STATE SERVICE
21/tcp    open  ftp
22/tcp    open  ssh
80/tcp    open  http
443/tcp   open  https
8000/tcp  open  http-alt
11211/tcp open  memcache

Nmap done: 1 IP address (1 host up) scanned in 1025.61 seconds
```

These may allow inside enumeration even if you can't login.