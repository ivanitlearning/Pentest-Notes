# Active Directory

## Impacket's scripts

### GetADUsers.py

This is used to enumerate the AD users of a domain. Requires domain user and password.

### GetNPUsers.py

This is used to dump the TGT hash of AD users which don't have "Require Kerberos pre-auth" checked.
Requires only domain to be specified only, neither AD user name nor password needed. Typically first step.

### GetUserSPNs.py

This is used to dump all the TGS hashes of AD user accounts which have Service Principal Names. They are usually (but not always) tied to some Windows application service so as to grant the service permissions to access resources (eg. networked shares). The service needs SPN so it can use Kerberos to authenticate with the AD.

### secretsdump.py

This is used to dump all the domain users NTLM hashes. These can then be used to PTH to get a shell with psexec.py or other tools.

Requires domain admin creds (to be confirmed).

## Post-exploitation

Check for DCSync permissions:

```shell
dsacls "DC=egotistical-bank,DC=local" > dsacls.txt
Get-Content dsacls.txt | Select-String -Pattern "Replicating Directory Changes"
```